!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("durruti/state")):"function"==typeof define&&define.amd?define(["durruti/state"],b):(a.durruti=a.durruti||{},a.durruti.Store=b(a.durruti._state))}(this,function(a){"use strict";function b(a){return JSON.parse(JSON.stringify(a))}function c(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],c=arguments[1],d=b(a);return Object.keys(c).forEach(function(b){"undefined"!=typeof d[b]?d[b]=a[b]:d[b]=c[b]}),d}function d(a,b){b=b||{};var d=!1;if("undefined"!=typeof window&&(d=!0),this.options=c(b,{history:d,state:e}),this.events={change:[]},this.data=[],a){var f=this.options.state.get(a);f&&this.data.push(f);var g=this;this.on("change",function(){g.options.state.set(a,g.get())})}}a="default"in a?a["default"]:a;var e=new a;return d.prototype.trigger=function(a){this.events[a]=this.events[a]||[];var b=this.events[a].slice();b.forEach(function(a){a()})},d.prototype.on=function(a,b){this.events[a]=this.events[a]||[],this.events[a].push(b)},d.prototype.off=function(a,b){this.events[a]=this.events[a]||[];var c=[].indexOf.call(this.events[a],b);c!==-1&&this.events[a].splice(c,1)},d.prototype.get=function(){var a=this.data[this.data.length-1];return a?b(a):null},d.prototype.list=function(){return b(this.data)},d.prototype.set=function(a){return this.options.history?this.data.push(a):this.data=[a],this.trigger("change"),this.get()},d});