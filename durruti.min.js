!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.durruti=b()}(this,function(){"use strict";function a(){return"undefined"!=typeof window}function b(){v===!0&&console.warn.apply(console,arguments)}function c(){var a=[];for(var b in document)"on"===b.substr(0,2)&&a.push(b);return a}function d(a,b,c){t.apply(this,arguments),x[this]=x[this]||[],x[this].push({type:a,fn:b,capture:c})}function e(a,b,c){for(var d=0;d<a.childNodes.length;d++)h(a.childNodes[d],b.childNodes[d],c)}function f(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].name]=null;for(var e=0;e<b.attributes.length;e++)c[b.attributes[e].name]=b.attributes[e].value;return c}function g(a,b){var c=f(a,b);for(var d in c)c[d]?a.setAttribute(d,c[d]):a.removeAttribute(d)}function h(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],d={node:a,newNode:b};return c.push(d),a.isEqualNode(b)?(z(a,!0),c):(1!==a.nodeType||1!==b.nodeType||a.tagName!==b.tagName||a.childNodes.length!==b.childNodes.length?d.replace=!0:(d.update=!0,z(a),e(a,b,c)),c)}function i(a){a.replace?a.node.parentNode.replaceChild(a.newNode,a.node):a.update&&g(a.node,a.newNode)}function j(a){return a.forEach(i),a}function k(a){var b;return b="function"==typeof a?new a:Object.create(a),b._durrutiId=String(G++),F[b._durrutiId]=b,b}function l(a){return a._durruti||F[a.getAttribute(D)]}function m(a,b){var c=[].slice.call(a.querySelectorAll(E));return b&&c.push(a),c.forEach(function(a){a._durruti=l(a),a.removeAttribute(D)}),c}function n(a){var b=l(a);b.unmount&&b.unmount(a),p(b)}function o(a){var b=l(a);b.mount&&b.mount(a)}function p(a){a?F[a._durrutiId]=null:(G=0,F={})}function q(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";a=a.trim();var b,c="div";if(0===a.indexOf("<tr")?c="tbody":0===a.indexOf("<td")&&(c="tr"),b=document.createElement(c),b.innerHTML=a,1!==b.children.length)throw new Error("Component template must have a single parent node.",a);return b.firstElementChild}function r(a,b){var c=a.indexOf("/>");c===-1&&(c=a.indexOf(">"));var d=" "+D+'="'+b._durrutiId+'"';return a.substr(0,c)+d+a.substr(c)}function s(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(a._durruti&&b.push(a),a.children)for(var c=0;c<a.children.length;c++)s(a.children[c],b);return b}var t,u=a(),v=!0,w=function(){},x={};if(u){var y=c();window.Node.prototype.hasOwnProperty("addEventListener")?(t=window.Node.prototype.addEventListener,window.Node.prototype.addEventListener=d):window.EventTarget.prototype.hasOwnProperty("addEventListener")&&(t=window.EventTarget.prototype.addEventListener,window.EventTarget.prototype.addEventListener=d),w=function(a,b){var c=x[a];if(c&&(c.forEach(function(b){a.removeEventListener(b.type,b.fn,b.capture)}),y.forEach(function(b){a[b]=null}),x[a]=null),b&&a.children)for(var d=0;d<a.children.length;d++)w(a.children[d],!0)}}var z=w,A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},B=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},C=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),D="data-durruti-id",E="["+D+"]",F={},G=0,H=function(){function a(){B(this,a)}return C(a,[{key:"server",value:function(){return p(),this}},{key:"render",value:function(a,c){var d=k(a);if("undefined"==typeof d.render)throw new Error("Components must have a render() method.");var e=d.render(),f=r(e,d);if(u&&c){var g,i,p=function(){if(!document.body.contains(c))return b("Node",c,"is no longer in the DOM. \nIt was probably removed by a parent component."),{v:void 0};var a=[];g=q(f),s(c).forEach(n),l(c)?(m(g,!0),i=h(c,g),i.forEach(function(b){b.node._durruti=b.newNode._durruti,b.node._durruti&&(b.replace?a.push(b.newNode):b.update?a.push(b.node):Array.prototype.push.apply(a,s(b.node)))}),j(i)):(c.firstElementChild&&c.firstElementChild.isEqualNode(g)||(c.innerHTML=f),a=m(c)),a.forEach(o)}();if("object"===("undefined"==typeof p?"undefined":A(p)))return p.v}return f}}]),a}(),I=new H;return I});