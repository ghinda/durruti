!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.durruti=b()}(this,function(){"use strict";function a(){return"undefined"!=typeof window}function b(){y===!0&&console.warn.apply(console,arguments)}function c(){var a=[];for(var b in document)"on"===b.substr(0,2)&&a.push(b);return a}function d(a,b,c){w.apply(this,arguments),A.push({target:this,type:a,fn:b,capture:c})}function e(a){a.forEach(function(a){B.forEach(function(b){a[b]=null})})}function f(a){for(var b=0;b<A.length;){if(a.indexOf(A[b].target)!==-1){var c=A[b].target;c.removeEventListener(A[b].type,A[b].fn,A[b].capture),A.splice(b,1),b--}b++}e(a)}function g(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(c.push(a),b&&a.children)for(var d=0;d<a.children.length;d++)g(a.children[d],!0,c);return c}function h(a,b,c){for(var d=0;d<a.childNodes.length;d++)k(a.childNodes[d],b.childNodes[d],c)}function i(a,b){for(var c={},d=a.attributes,e=b.attributes,f=0;f<d.length;f++)c[d[f].name.toLowerCase()]=null;for(var g=0;g<e.length;g++)c[e[g].name.toLowerCase()]=e[g].value;return c}function j(a,b){var c=i(a,b);for(var d in c)null===c[d]?a.removeAttribute(d):a.setAttribute(d,c[d]),a[D[d]||d]=c[d]}function k(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],d={node:a,newNode:b};return c.push(d),a.isEqualNode(b)?(d.equal=!0,c):(1!==a.nodeType||1!==b.nodeType||a.tagName!==b.tagName||a.childNodes.length!==b.childNodes.length?d.replace=!0:(a.cloneNode().isEqualNode(b.cloneNode())||(d.update=!0),h(a,b,c)),c)}function l(a){a.replace?a.node.parentNode.replaceChild(a.newNode,a.node):a.update?(j(a.node,a.newNode),C(a.node)):C(a.node,!0)}function m(a){return a.forEach(l),a}function n(a){var b;return b="function"==typeof a?new a:Object.create(a),b._durrutiId=String(J++),I.push({id:b._durrutiId,component:b}),b}function o(a){if(a._durruti)return a._durruti;for(var b=a.getAttribute(G),c=0;c<I.length;c++)if(I[c].id===b)return I[c].component}function p(a,b){var c=[].slice.call(a.querySelectorAll(H));return b&&c.push(a),c.forEach(function(a){a._durruti=o(a),a.removeAttribute(G)}),c}function q(a){var b=o(a);b.unmount&&b.unmount(a),s(b)}function r(a){var b=o(a);b.mount&&b.mount(a)}function s(a){if(a){for(var b=0;b<I.length;b++)if(I[b].id===a._durrutiId)return void I.splice(b,1)}else J=0,I.length=0}function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";a=a.trim();var b,c="div";if(0===a.indexOf("<tr")?c="tbody":0===a.indexOf("<td")&&(c="tr"),b=document.createElement(c),b.innerHTML=a,1!==b.children.length)throw new Error("Component template must have a single parent node.",a);return b.firstElementChild}function u(a,b){var c=a.indexOf("/>");c===-1&&(c=a.indexOf(">"));var d=" "+G+'="'+b._durrutiId+'"';return a.substr(0,c)+d+a.substr(c)}function v(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(a._durruti&&c.push(a),b&&a.children)for(var d=0;d<a.children.length;d++)v(a.children[d],b,c);return c}var w,x=a(),y=!0,z=function(){},A=[],B=[];x&&(B=c(),window.Node.prototype.hasOwnProperty("addEventListener")?(w=window.Node.prototype.addEventListener,window.Node.prototype.addEventListener=d):window.EventTarget.prototype.hasOwnProperty("addEventListener")&&(w=window.EventTarget.prototype.addEventListener,window.EventTarget.prototype.addEventListener=d),z=function(a,b){f(g(a,b))});var C=z,D={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},E=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},F=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),G="data-durruti-id",H="["+G+"]",I=[],J=0,K=function(){function a(){E(this,a)}return F(a,[{key:"server",value:function(){return s(),this}},{key:"render",value:function(a,c){var d=n(a);if("undefined"==typeof d.render)throw new Error("Components must have a render() method.");var e=d.render(),f=u(e,d);if(x&&c){if(!document.body.contains(c))return void b("Node",c,"is no longer in the DOM. \nIt was probably removed by a parent component.");var g=[],h=t(f);if(v(c).forEach(q),o(c)){p(h,!0);var i=k(c,h);i.forEach(function(a){a.node._durruti=a.newNode._durruti;var b=[];b=a.update?v(a.node,!1):a.replace?v(a.newNode):v(a.node,!!a.equal),Array.prototype.push.apply(g,b)}),m(i)}else c.firstElementChild&&c.firstElementChild.isEqualNode(h)||(c.innerHTML=f),g=p(c);g.forEach(r)}return f}}]),a}(),L=new K;return L});