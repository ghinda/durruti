!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.durruti=b()}(this,function(){"use strict";function a(){return"undefined"!=typeof window}function b(){w===!0&&console.warn.apply(console,arguments)}function c(){var a=[];for(var b in document)"on"===b.substr(0,2)&&a.push(b);return a}function d(a,b,c){u.apply(this,arguments),y.push({target:this,type:a,fn:b,capture:c})}function e(a){for(var b=0;b<y.length;)y[b].target===a&&(a.removeEventListener(y[b].type,y[b].fn,y[b].capture),y.splice(b,1),b--),b++;z.forEach(function(b){a[b]=null})}function f(a,b,c){for(var d=0;d<a.childNodes.length;d++)i(a.childNodes[d],b.childNodes[d],c)}function g(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].name]=null;for(var e=0;e<b.attributes.length;e++)c[b.attributes[e].name]=b.attributes[e].value;return c}function h(a,b){var c=g(a,b);for(var d in c)c[d]?a.setAttribute(d,c[d]):(a.removeAttribute(d),"checked"===d&&(a.checked=!1))}function i(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],d={node:a,newNode:b};return c.push(d),a.isEqualNode(b)?(A(a,!0),c):(1!==a.nodeType||1!==b.nodeType||a.tagName!==b.tagName||a.childNodes.length!==b.childNodes.length?d.replace=!0:(d.update=!0,A(a),f(a,b,c)),c)}function j(a){a.replace?a.node.parentNode.replaceChild(a.newNode,a.node):a.update&&h(a.node,a.newNode)}function k(a){return a.forEach(j),a}function l(a){var b;return b="function"==typeof a?new a:Object.create(a),b._durrutiId=String(H++),G.push({id:b._durrutiId,component:b}),b}function m(a){if(a._durruti)return a._durruti;for(var b=a.getAttribute(E),c=0;c<G.length;c++)if(G[c].id===b)return G[c].component}function n(a,b){var c=[].slice.call(a.querySelectorAll(F));return b&&c.push(a),c.forEach(function(a){a._durruti=m(a),a.removeAttribute(E)}),c}function o(a){var b=m(a);b.unmount&&b.unmount(a),q(b)}function p(a){var b=m(a);b.mount&&b.mount(a)}function q(a){if(a){for(var b=0;b<G.length;b++)if(G[b].id===a._durrutiId)return void G.splice(b,1)}else H=0,G.length=0}function r(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";a=a.trim();var b,c="div";if(0===a.indexOf("<tr")?c="tbody":0===a.indexOf("<td")&&(c="tr"),b=document.createElement(c),b.innerHTML=a,1!==b.children.length)throw new Error("Component template must have a single parent node.",a);return b.firstElementChild}function s(a,b){var c=a.indexOf("/>");c===-1&&(c=a.indexOf(">"));var d=" "+E+'="'+b._durrutiId+'"';return a.substr(0,c)+d+a.substr(c)}function t(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(a._durruti&&b.push(a),a.children)for(var c=0;c<a.children.length;c++)t(a.children[c],b);return b}var u,v=a(),w=!0,x=function(){},y=[],z=[];v&&(z=c(),window.Node.prototype.hasOwnProperty("addEventListener")?(u=window.Node.prototype.addEventListener,window.Node.prototype.addEventListener=d):window.EventTarget.prototype.hasOwnProperty("addEventListener")&&(u=window.EventTarget.prototype.addEventListener,window.EventTarget.prototype.addEventListener=d),x=function(a,b){if(e(a),b&&a.children)for(var c=0;c<a.children.length;c++)x(a.children[c],!0)});var A=x,B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},C=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},D=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),E="data-durruti-id",F="["+E+"]",G=[],H=0,I=function(){function a(){C(this,a)}return D(a,[{key:"server",value:function(){return q(),this}},{key:"render",value:function(a,c){var d=l(a);if("undefined"==typeof d.render)throw new Error("Components must have a render() method.");var e=d.render(),f=s(e,d);if(v&&c){var g,h,j=function(){if(!document.body.contains(c))return b("Node",c,"is no longer in the DOM. \nIt was probably removed by a parent component."),{v:void 0};var a=[];g=r(f),t(c).forEach(o),m(c)?(n(g,!0),h=i(c,g),h.forEach(function(b){b.node._durruti=b.newNode._durruti,b.node._durruti&&(b.replace?a.push(b.newNode):b.update?a.push(b.node):Array.prototype.push.apply(a,t(b.node)))}),k(h)):(c.firstElementChild&&c.firstElementChild.isEqualNode(g)||(c.innerHTML=f),a=n(c)),a.forEach(p)}();if("object"===("undefined"==typeof j?"undefined":B(j)))return j.v}return f}}]),a}(),J=new I;return J});