!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.durruti=b()}(this,function(){"use strict";function a(){return"undefined"!=typeof window}function b(){y===!0&&console.warn.apply(console,arguments)}function c(){var a=[];for(var b in document)"on"===b.substr(0,2)&&a.push(b);return a}function d(a,b,c){w.apply(this,arguments),A.push({target:this,type:a,fn:b,capture:c})}function e(a){a.forEach(function(a){B.forEach(function(b){a[b]=null})})}function f(a){for(var b=0;b<A.length;){if(a.indexOf(A[b].target)!==-1){var c=A[b].target;c.removeEventListener(A[b].type,A[b].fn,A[b].capture),A.splice(b,1),b--}b++}e(a)}function g(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(c.push(a),b&&a.children)for(var d=0;d<a.children.length;d++)g(a.children[d],!0,c);return c}function h(a,b,c){for(var d=0;d<a.childNodes.length;d++)k(a.childNodes[d],b.childNodes[d],c)}function i(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].name]=null;for(var e=0;e<b.attributes.length;e++)c[b.attributes[e].name]=b.attributes[e].value;return c}function j(a,b){var c=i(a,b);for(var d in c)null===c[d]?a.removeAttribute(d):a.setAttribute(d,c[d]),a[D[d]||d]=c[d]}function k(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],d={node:a,newNode:b};return c.push(d),a.isEqualNode(b)?c:(1!==a.nodeType||1!==b.nodeType||a.tagName!==b.tagName||a.childNodes.length!==b.childNodes.length?d.replace=!0:(d.update=!0,h(a,b,c)),c)}function l(a){a.replace?a.node.parentNode.replaceChild(a.newNode,a.node):a.update?(j(a.node,a.newNode),C(a.node)):C(a.node,!0)}function m(a){return a.forEach(l),a}function n(a){var b;return b="function"==typeof a?new a:Object.create(a),b._durrutiId=String(K++),J.push({id:b._durrutiId,component:b}),b}function o(a){if(a._durruti)return a._durruti;for(var b=a.getAttribute(H),c=0;c<J.length;c++)if(J[c].id===b)return J[c].component}function p(a,b){var c=[].slice.call(a.querySelectorAll(I));return b&&c.push(a),c.forEach(function(a){a._durruti=o(a),a.removeAttribute(H)}),c}function q(a){var b=o(a);b.unmount&&b.unmount(a),s(b)}function r(a){var b=o(a);b.mount&&b.mount(a)}function s(a){if(a){for(var b=0;b<J.length;b++)if(J[b].id===a._durrutiId)return void J.splice(b,1)}else K=0,J.length=0}function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";a=a.trim();var b,c="div";if(0===a.indexOf("<tr")?c="tbody":0===a.indexOf("<td")&&(c="tr"),b=document.createElement(c),b.innerHTML=a,1!==b.children.length)throw new Error("Component template must have a single parent node.",a);return b.firstElementChild}function u(a,b){var c=a.indexOf("/>");c===-1&&(c=a.indexOf(">"));var d=" "+H+'="'+b._durrutiId+'"';return a.substr(0,c)+d+a.substr(c)}function v(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(a._durruti&&b.push(a),a.children)for(var c=0;c<a.children.length;c++)v(a.children[c],b);return b}var w,x=a(),y=!0,z=function(){},A=[],B=[];x&&(B=c(),window.Node.prototype.hasOwnProperty("addEventListener")?(w=window.Node.prototype.addEventListener,window.Node.prototype.addEventListener=d):window.EventTarget.prototype.hasOwnProperty("addEventListener")&&(w=window.EventTarget.prototype.addEventListener,window.EventTarget.prototype.addEventListener=d),z=function(a,b){f(g(a,b))});var C=z,D={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},F=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},G=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),H="data-durruti-id",I="["+H+"]",J=[],K=0,L=function(){function a(){F(this,a)}return G(a,[{key:"server",value:function(){return s(),this}},{key:"render",value:function(a,c){var d=n(a);if("undefined"==typeof d.render)throw new Error("Components must have a render() method.");var e=d.render(),f=u(e,d);if(x&&c){var g,h,i=function(){if(!document.body.contains(c))return b("Node",c,"is no longer in the DOM. \nIt was probably removed by a parent component."),{v:void 0};var a=[];g=t(f),v(c).forEach(q),o(c)?(p(g,!0),h=k(c,g),h.forEach(function(b){b.node._durruti=b.newNode._durruti,b.node._durruti&&(b.replace?a.push(b.newNode):b.update?a.push(b.node):Array.prototype.push.apply(a,v(b.node)))}),m(h)):(c.firstElementChild&&c.firstElementChild.isEqualNode(g)||(c.innerHTML=f),a=p(c)),a.forEach(r)}();if("object"===("undefined"==typeof i?"undefined":E(i)))return i.v}return f}}]),a}(),M=new L;return M});