{"version":3,"file":null,"sources":["/run/media/mokush/work/dev/durruti/src/util.js","/run/media/mokush/work/dev/durruti/src/listeners.js","/run/media/mokush/work/dev/durruti/src/dom.js","/run/media/mokush/work/dev/durruti/src/durruti.js"],"sourcesContent":["/* Durruti\n * Utils.\n */\n\nfunction hasWindow () {\n  return (typeof window !== 'undefined')\n}\n\nexport var isClient = hasWindow()\n\nexport function clone (obj) {\n  return JSON.parse(JSON.stringify(obj))\n}\n\n// one-level object extend\nexport function extend (obj = {}, defaults) {\n  // clone object\n  var extended = clone(obj)\n\n  // copy default keys where undefined\n  Object.keys(defaults).forEach(function (key) {\n    if (typeof extended[key] === 'undefined') {\n      extended[key] = defaults[key]\n    }\n  })\n\n  return extended\n}\n\nvar DURRUTI_DEBUG = true\n\nexport function warn () {\n  if (DURRUTI_DEBUG === true) {\n    console.warn.apply(console, arguments)\n  }\n}\n","/* Durruti\n * Capture and remove event listeners.\n */\n\nimport * as util from './util'\n\nvar removeListeners = () => {}\n\n// capture all listeners\nvar events = []\nvar domEventTypes = []\n\nfunction getDomEventTypes () {\n  var eventTypes = []\n  for (let attr in document) {\n    // starts with on\n    if (attr.substr(0, 2) === 'on') {\n      eventTypes.push(attr)\n    }\n  }\n\n  return eventTypes\n}\n\nvar originalAddEventListener\n\nfunction captureAddEventListener (type, fn, capture) {\n  originalAddEventListener.apply(this, arguments)\n\n  events.push({\n    target: this,\n    type: type,\n    fn: fn,\n    capture: capture\n  })\n}\n\nfunction removeNodeEvents ($node) {\n  var i = 0\n\n  while (i < events.length) {\n    if (events[i].target === $node) {\n      // remove listener\n      $node.removeEventListener(events[i].type, events[i].fn, events[i].capture)\n\n      // remove event\n      events.splice(i, 1)\n      i--\n    }\n\n    i++\n  }\n\n  // remove on* listeners\n  domEventTypes.forEach((eventType) => {\n    $node[eventType] = null\n  })\n}\n\nif (util.isClient) {\n  domEventTypes = getDomEventTypes()\n\n  // capture addEventListener\n\n  // IE\n  if (window.Node.prototype.hasOwnProperty('addEventListener')) {\n    originalAddEventListener = window.Node.prototype.addEventListener\n    window.Node.prototype.addEventListener = captureAddEventListener\n  } else if (window.EventTarget.prototype.hasOwnProperty('addEventListener')) {\n    // standard\n    originalAddEventListener = window.EventTarget.prototype.addEventListener\n    window.EventTarget.prototype.addEventListener = captureAddEventListener\n  }\n\n  // traverse and remove all events listeners from nodes\n  removeListeners = ($node, traverse) => {\n    removeNodeEvents($node)\n\n    // traverse element children\n    if (traverse && $node.children) {\n      for (let i = 0; i < $node.children.length; i++) {\n        removeListeners($node.children[i], true)\n      }\n    }\n  }\n}\n\nexport default removeListeners\n","/* Durruti\n * DOM patch - morphs a DOM node into another.\n */\n\nimport removeListeners from './listeners.js'\n\nfunction traverse ($node, $newNode, patches) {\n  // traverse\n  for (let i = 0; i < $node.childNodes.length; i++) {\n    diff($node.childNodes[i], $newNode.childNodes[i], patches)\n  }\n}\n\nfunction mapAttributes ($node, $newNode) {\n  var attrs = {}\n\n  for (let i = 0; i < $node.attributes.length; i++) {\n    attrs[$node.attributes[i].name] = null\n  }\n\n  for (let i = 0; i < $newNode.attributes.length; i++) {\n    attrs[$newNode.attributes[i].name] = $newNode.attributes[i].value\n  }\n\n  return attrs\n}\n\nfunction patchAttrs ($node, $newNode) {\n  // map attributes\n  var attrs = mapAttributes($node, $newNode)\n\n  // add-change attributes\n  for (let prop in attrs) {\n    if (!attrs[prop]) {\n      $node.removeAttribute(prop)\n\n      // checked needs extra work\n      if (prop === 'checked') {\n        $node.checked = false\n      }\n    } else {\n      $node.setAttribute(prop, attrs[prop])\n    }\n  }\n}\n\nexport function diff ($node, $newNode, patches = []) {\n  var patch = {\n    node: $node,\n    newNode: $newNode\n  }\n\n  // push traversed node to patch list\n  patches.push(patch)\n\n  // faster than outerhtml\n  if ($node.isEqualNode($newNode)) {\n    // remove listeners on node and children\n    removeListeners($node, true)\n\n    return patches\n  }\n\n  // if one of them is not an element node,\n  // or the tag changed,\n  // or not the same number of children.\n  if ($node.nodeType !== 1 ||\n    $newNode.nodeType !== 1 ||\n    $node.tagName !== $newNode.tagName ||\n    $node.childNodes.length !== $newNode.childNodes.length) {\n    patch.replace = true\n  } else {\n    patch.update = true\n\n    // remove listeners on node\n    removeListeners($node)\n\n    // traverse childNodes\n    traverse($node, $newNode, patches)\n  }\n\n  return patches\n}\n\nfunction applyPatch (patch) {\n  if (patch.replace) {\n    patch.node.parentNode.replaceChild(patch.newNode, patch.node)\n  } else if (patch.update) {\n    patchAttrs(patch.node, patch.newNode)\n  }\n}\n\nexport function patch (patches) {\n  patches.forEach(applyPatch)\n\n  return patches\n}\n\n","/* Durruti\n * Micro Isomorphic JavaScript library for building user interfaces.\n */\n\nimport * as util from './util'\nimport * as dom from './dom'\n\nconst durrutiAttr = 'data-durruti-id'\nconst durrutiElemSelector = `[${durrutiAttr}]`\nvar componentCache = []\nvar componentIndex = 0\n\n// decorate a basic class with durruti specific properties\nfunction decorate (Comp) {\n  var component\n\n  // instantiate classes\n  if (typeof Comp === 'function') {\n    component = new Comp()\n  } else {\n    // make sure we don't change the id on a cached component\n    component = Object.create(Comp)\n  }\n\n  // components get a new id on render,\n  // so we can clear the previous component cache.\n  component._durrutiId = String(componentIndex++)\n\n  // cache component\n  componentCache.push({\n    id: component._durrutiId,\n    component: component\n  })\n\n  return component\n}\n\nfunction getCachedComponent ($node) {\n  // get the component from the dom node - rendered in browser.\n  if ($node._durruti) {\n    return $node._durruti\n  }\n\n  // or get it from the component cache - rendered on the server.\n  var id = $node.getAttribute(durrutiAttr)\n  for (var i = 0; i < componentCache.length; i++) {\n    if (componentCache[i].id === id) {\n      return componentCache[i].component\n    }\n  }\n}\n\n// remove custom data attributes,\n// and cache the component on the DOM node.\nfunction cleanAttrNodes ($container, includeParent) {\n  var nodes = [].slice.call($container.querySelectorAll(durrutiElemSelector))\n\n  if (includeParent) {\n    nodes.push($container)\n  }\n\n  nodes.forEach(($node) => {\n    // cache component in node\n    $node._durruti = getCachedComponent($node)\n\n    // clean-up data attributes\n    $node.removeAttribute(durrutiAttr)\n  })\n\n  return nodes\n}\n\nfunction unmountNode ($node) {\n  var cachedComponent = getCachedComponent($node)\n\n  if (cachedComponent.unmount) {\n    cachedComponent.unmount($node)\n  }\n\n  // clear the component from the cache\n  clearComponentCache(cachedComponent)\n}\n\nfunction mountNode ($node) {\n  var cachedComponent = getCachedComponent($node)\n\n  if (cachedComponent.mount) {\n    cachedComponent.mount($node)\n  }\n}\n\nfunction clearComponentCache (component) {\n  if (component) {\n    for (var i = 0; i < componentCache.length; i++) {\n      if (componentCache[i].id === component._durrutiId) {\n        componentCache.splice(i, 1)\n        return\n      }\n    }\n  } else {\n    // clear the entire component cache\n    componentIndex = 0\n    componentCache.length = 0\n  }\n}\n\nfunction createFragment (template = '') {\n  template = template.trim()\n  var parent = 'div'\n  var $node\n\n  if (template.indexOf('<tr') === 0) {\n    // table row\n    parent = 'tbody'\n  } else if (template.indexOf('<td') === 0) {\n    // table column\n    parent = 'tr'\n  }\n\n  $node = document.createElement(parent)\n  $node.innerHTML = template\n\n  if ($node.children.length !== 1) {\n    throw new Error('Component template must have a single parent node.', template)\n  }\n\n  return $node.firstElementChild\n}\n\nfunction addComponentId (template, component) {\n  // naive implementation of adding an attribute to the parent container.\n  // so we don't depend on a dom parser.\n  // downside is we can't warn that template MUST have a single parent (in Node.js).\n\n  // check void elements first.\n  var firstBracketIndex = template.indexOf('/>')\n\n  // non-void elements\n  if (firstBracketIndex === -1) {\n    firstBracketIndex = template.indexOf('>')\n  }\n\n  var attr = ` ${durrutiAttr}=\"${component._durrutiId}\"`\n\n  return template.substr(0, firstBracketIndex) + attr + template.substr(firstBracketIndex)\n}\n\n// traverse and find durruti nodes\nfunction getComponentNodes ($container, arr = []) {\n  if ($container._durruti) {\n    arr.push($container)\n  }\n\n  if ($container.children) {\n    for (let i = 0; i < $container.children.length; i++) {\n      getComponentNodes($container.children[i], arr)\n    }\n  }\n\n  return arr\n}\n\nclass Durruti {\n  server () {\n    clearComponentCache()\n\n    return this\n  }\n\n  render (component, $container) {\n    // decorate basic classes with durruti properties\n    var durrutiComponent = decorate(component)\n\n    if (typeof durrutiComponent.render === 'undefined') {\n      throw new Error('Components must have a render() method.')\n    }\n\n    var template = durrutiComponent.render()\n    var componentHtml = addComponentId(template, durrutiComponent)\n\n    // mount and unmount in browser, when we specify a container.\n    if (util.isClient && $container) {\n      // check if the container is still in the DOM.\n      // when running multiple parallel render's, the container\n      // is removed by the previous render, but the reference still in memory.\n      if (!document.body.contains($container)) {\n        // warn for performance.\n        util.warn('Node', $container, 'is no longer in the DOM. \\nIt was probably removed by a parent component.')\n        return\n      }\n\n      let componentNodes = []\n      // convert the template string to a dom node\n      var $newComponent = createFragment(componentHtml)\n\n      // unmount component and sub-components\n      getComponentNodes($container).forEach(unmountNode)\n\n      // if the container is a durruti element,\n      // unmount it and it's children and replace the node.\n      if (getCachedComponent($container)) {\n        // remove the data attributes on the new node,\n        // before patch,\n        // and get the list of new components.\n        cleanAttrNodes($newComponent, true)\n\n        // get required dom patches\n        var patches = dom.diff($container, $newComponent)\n\n        patches.forEach(function (patch) {\n          // always update component instances,\n          // even if the dom doesn't change.\n          patch.node._durruti = patch.newNode._durruti\n\n          // patches contain all the traversed nodes.\n          // get the mount components here, for performance.\n          if (patch.node._durruti) {\n            if (patch.replace) {\n              componentNodes.push(patch.newNode)\n            } else if (patch.update) {\n              componentNodes.push(patch.node)\n            } else {\n              // node is the same,\n              // but we need to mount sub-components.\n              Array.prototype.push.apply(componentNodes, getComponentNodes(patch.node))\n            }\n          }\n        })\n\n        // morph old dom node into new one\n        dom.patch(patches)\n      } else {\n        // if the component is not a durruti element,\n        // insert the template with innerHTML.\n\n        // only if the same html is not already rendered\n        if (!$container.firstElementChild ||\n          !$container.firstElementChild.isEqualNode($newComponent)) {\n          $container.innerHTML = componentHtml\n        }\n\n        componentNodes = cleanAttrNodes($container)\n      }\n\n      // mount newly added components\n      componentNodes.forEach(mountNode)\n    }\n\n    return componentHtml\n  }\n}\n\nexport default new Durruti()\n"],"names":["util.isClient","dom.diff","patch"],"mappings":"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"}