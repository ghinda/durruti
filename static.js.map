{"version":3,"file":"static.js","sources":["src/util.js","src/static.js"],"sourcesContent":["/* Durruti\n * Utils.\n */\n\nexport function clone (obj) {\n  return JSON.parse(JSON.stringify(obj))\n}\n\n// one-level object extend\nexport function extend (obj, defaults) {\n  if (obj === null) {\n    obj = {}\n  }\n\n  // clone object\n  var extended = clone(obj)\n\n  // copy default keys where undefined\n  Object.keys(defaults).forEach(function (key) {\n    if (typeof extended[key] !== 'undefined') {\n      extended[key] = obj[key]\n    } else {\n      extended[key] = defaults[key]\n    }\n  })\n\n  return extended\n}\n\nif (typeof window !== 'undefined') {\n  global = window\n}\nvar debugFlag = 'DURRUTI_DEBUG'\nglobal[debugFlag] = true\n\nexport function warn () {\n  if (global[debugFlag] === true) {\n    console.warn.apply(console, arguments)\n  }\n}\n","/* Durruti\n * Static site generator.\n */\n\nimport fs from 'fs'\nimport http from 'http'\nimport mkdirp from 'mkdirp'\nimport * as util from './util'\n\nfunction fetch (params, callback) {\n  params = util.extend(params, {\n    host: 'localhost',\n    port: 3000,\n    path: '/'\n  })\n\n  var req = http.request({\n    host: params.host,\n    port: params.port,\n    path: params.path,\n    method: 'GET'\n  }, function (res) {\n    var page = ''\n    res.setEncoding('utf8')\n    res.on('data', function (chunk) {\n      page += chunk\n    })\n\n    res.on('end', function () {\n      callback(null, page)\n    })\n  })\n\n  req.end()\n}\n\nfunction write (params, callback) {\n  params = util.extend(params, {\n    dir: './static'\n  })\n\n  var path = params.dir\n\n  // check last char, to always end with /\n  if (path.slice(-1) !== '/') {\n    path += '/'\n  }\n\n  // check first chart, to never start with /\n  if (params.path[0] === '/') {\n    // remove the first char\n    params.path = params.path.slice(1)\n  }\n\n  path += params.path\n\n  // split path into fragments\n  var pathFragments = path.split('/')\n  var file = pathFragments[pathFragments.length - 1]\n\n  if (file.indexOf('.') !== -1) {\n    // has file extension, remove the last fragment\n    pathFragments.pop()\n  } else {\n    // doesn't have an extension\n    // check last char, to always end with /\n    if (path.slice(-1) !== '/') {\n      path += '/'\n    }\n\n    // add index.html\n    path += 'index.html'\n  }\n\n  // create nested folders\n  mkdirp.sync(pathFragments.join('/'))\n\n  fs.writeFile(path, params.content, function (err) {\n    if (err) {\n      return console.log(err)\n    }\n\n    callback(err, path)\n  })\n}\n\nfunction writePage (params) {\n  return new Promise(function (resolve, reject) {\n    fetch(params, function (err, res) {\n      if (err) {\n        return reject(err)\n      }\n\n      params = util.extend(params, {\n        content: res\n      })\n\n      write(params, function (err, res) {\n        if (err) {\n          return reject(err)\n        }\n\n        resolve(res)\n      })\n    })\n  })\n}\n\nfunction render (params, callback) {\n  Promise.all(params.pages.map(function (page) {\n    var options = util.extend(params, {\n      path: page\n    })\n\n    return writePage(options)\n  }))\n  .then(function (pages) {\n    var message = 'Rendered pages: \\n * '\n    message += pages.join('\\n * ')\n\n    console.log(message)\n\n    callback()\n  })\n}\n\nfunction Static () {\n  this.render = render\n}\n\nexport default new Static()\n"],"names":["util.extend"],"mappings":"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"}