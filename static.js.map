{"version":3,"file":null,"sources":["/run/media/mokush/work/dev/durruti/src/util.js","/run/media/mokush/work/dev/durruti/src/static.js"],"sourcesContent":["/* Durruti\n * Utils.\n */\n\nfunction hasWindow () {\n  return (typeof window !== 'undefined')\n}\n\nexport var isClient = hasWindow()\n\nexport function clone (obj) {\n  return JSON.parse(JSON.stringify(obj))\n}\n\n// one-level object extend\nexport function extend (obj = {}, defaults) {\n  // clone object\n  var extended = clone(obj)\n\n  // copy default keys where undefined\n  Object.keys(defaults).forEach(function (key) {\n    if (typeof extended[key] !== 'undefined') {\n      extended[key] = obj[key]\n    } else {\n      extended[key] = defaults[key]\n    }\n  })\n\n  return extended\n}\n\nvar DURRUTI_DEBUG = true\n\nexport function warn () {\n  if (DURRUTI_DEBUG === true) {\n    console.warn.apply(console, arguments)\n  }\n}\n","/* Durruti\n * Static site generator.\n */\n\nimport fs from 'fs'\nimport http from 'http'\nimport mkdirp from 'mkdirp'\nimport * as util from './util'\n\nfunction fetch (params, callback) {\n  params = util.extend(params, {\n    host: 'localhost',\n    port: 3000,\n    path: '/'\n  })\n\n  var req = http.request({\n    host: params.host,\n    port: params.port,\n    path: params.path,\n    method: 'GET'\n  }, (res) => {\n    var page = ''\n    res.setEncoding('utf8')\n    res.on('data', (chunk) => {\n      page += chunk\n    })\n\n    res.on('end', () => {\n      callback(null, page)\n    })\n  })\n\n  req.end()\n}\n\nfunction write (params, callback) {\n  params = util.extend(params, {\n    dir: './static'\n  })\n\n  var path = params.dir\n\n  // check last char, to always end with /\n  if (path.slice(-1) !== '/') {\n    path += '/'\n  }\n\n  // check first chart, to never start with /\n  if (params.path[0] === '/') {\n    // remove the first char\n    params.path = params.path.slice(1)\n  }\n\n  path += params.path\n\n  // split path into fragments\n  var pathFragments = path.split('/')\n  var file = pathFragments[pathFragments.length - 1]\n\n  if (file.indexOf('.') !== -1) {\n    // has file extension, remove the last fragment\n    pathFragments.pop()\n  } else {\n    // doesn't have an extension\n    // check last char, to always end with /\n    if (path.slice(-1) !== '/') {\n      path += '/'\n    }\n\n    // add index.html\n    path += 'index.html'\n  }\n\n  // create nested folders\n  mkdirp.sync(pathFragments.join('/'))\n\n  fs.writeFile(path, params.content, (err) => {\n    if (err) {\n      return console.log(err)\n    }\n\n    callback(err, path)\n  })\n}\n\nfunction writePage (params) {\n  return new Promise((resolve, reject) => {\n    fetch(params, (err, res) => {\n      if (err) {\n        return reject(err)\n      }\n\n      params = util.extend(params, {\n        content: res\n      })\n\n      write(params, (err, res) => {\n        if (err) {\n          return reject(err)\n        }\n\n        resolve(res)\n      })\n    })\n  })\n}\n\nclass Static {\n  render (params, callback) {\n    Promise.all(params.pages.map((page) => {\n      var options = util.extend(params, {\n        path: page\n      })\n\n      return writePage(options)\n    }))\n    .then((pages) => {\n      var message = `Rendered pages: \\n * ${pages.join('\\n * ')}`\n\n      console.log(message)\n\n      callback()\n    })\n  }\n}\n\nexport default new Static()\n"],"names":["util.extend"],"mappings":"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"}